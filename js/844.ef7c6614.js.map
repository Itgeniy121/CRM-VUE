{"version":3,"file":"js/844.ef7c6614.js","mappings":"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","sources":["webpack://crm-system/./src/views/RecordPage.vue","webpack://crm-system/./src/views/RecordPage.vue?001b"],"sourcesContent":["<template>\r\n    <div>\r\n  <div class=\"page-title\">\r\n    <h3>Новая запись</h3>\r\n  </div>\r\n\r\n  <Loader v-if=\"loading\"/>\r\n\r\n  <p class = 'center'\r\n  v-else-if=\"!categories.length\"\r\n  >Категорий пока что нет. Вы можете добавить их <router-link to=\"/categories\">тут</router-link></p>\r\n\r\n  <form class=\"form\" v-else @submit.prevent=\"submitHandler\"> \r\n    <div class=\"input-field\" >\r\n      <select ref=\"select\" v-model=\"currentCategory\">\r\n        <option\r\n                v-for=\"c in categories\"\r\n                :key=\"c.id\"\r\n                :value=\"c.id\"\r\n                >\r\n                {{ c.name }}\r\n              </option>\r\n      </select>\r\n      <label>Выберите категорию</label>\r\n    </div>\r\n\r\n    <p>\r\n      <label>\r\n        <input\r\n            class=\"with-gap\"\r\n            name=\"type\"\r\n            type=\"radio\"\r\n            value=\"income\"\r\n            v-model=\"type\"    \r\n                />\r\n        <span>Доход</span>\r\n      </label>\r\n    </p>\r\n\r\n    <p>\r\n      <label>\r\n        <input\r\n            class=\"with-gap\"\r\n            name=\"type\"\r\n            type=\"radio\"\r\n            value=\"outcome\"\r\n            v-model=\"type\"\r\n        />\r\n        <span>Расход</span>\r\n      </label>\r\n    </p>\r\n\r\n    <div class=\"input-field\">\r\n      <input\r\n      id=\"amount\"\r\n      type=\"number\"\r\n      v-model.trim=\"amount\"\r\n      :class=\"{invalid: (v$.amount.required.$invalid == true && v$.amount.$dirty == true) || (v$.amount.minValue.$invalid == true && v$.amount.$dirty == true) }\"               \r\n      >\r\n      \r\n      <label for=\"amount\">Сумма</label>\r\n      <span \r\n              v-if=\"v$.amount.required.$invalid == true && v$.amount.$dirty == true\"\r\n              class=\"helper-text invalid\">\r\n              Введите сумму\r\n            </span>\r\n            <span \r\n              v-else-if=\"v$.amount.minValue.$invalid == true\" \r\n              class=\"helper-text invalid\">\r\n              Сумма должна быть больше 0\r\n            </span>\r\n    </div>\r\n\r\n    <div class=\"input-field\">\r\n      <input\r\n          id=\"description\"\r\n          type=\"text\"\r\n          v-model=\"description\"\r\n          :class=\"{invalid: (v$.description.required.$invalid == true && v$.description.$dirty == true)}\"\r\n      >\r\n      <label for=\"description\">Описание</label>\r\n      <span \r\n        v-if=\"v$.description.required.$invalid == true && v$.description.$dirty == true\"\r\n        class=\"helper-text invalid\">\r\n        Задайте описание\r\n      </span>\r\n    </div>\r\n\r\n    <button class=\"btn waves-effect waves-light\" type=\"submit\">\r\n      Создать\r\n      <i class=\"material-icons right\">send</i>\r\n    </button>\r\n  </form>\r\n</div>\r\n</template>\r\n<script>\r\nimport { useVuelidate } from '@vuelidate/core'\r\nimport { required, minValue } from '@vuelidate/validators'\r\nimport { mapGetters } from 'vuex'\r\nimport { computed, reactive } from 'vue';\r\nimport {useHead} from \"@vueuse/head\"\r\nexport default{\r\n  name: 'record',\r\n  setup () {\r\n    const siteData = reactive({\r\n      title: 'Record',\r\n      description: \"aboba\"\r\n    })\r\n    useHead({\r\n      title: computed(() => siteData.title),\r\n      meta: [\r\n        {\r\n          name: `description`,\r\n          content: computed(() => siteData.description)\r\n        },\r\n      ],\r\n    })\r\n    return { v$: useVuelidate() }\r\n\r\n   \r\n  },\r\n  data:() => ({\r\n    loading: true,\r\n    categories: null,\r\n    select: null,\r\n    currentCategory: null,\r\n    type: 'income',\r\n    amount: null,\r\n    description: null,\r\n  }),\r\n  validations () {\r\n    return {\r\n      amount:{required, minValue: minValue(1)},\r\n      description: {required},\r\n    }\r\n  },\r\n   async mounted(){\r\n    this.categories = await this.$store.dispatch('fetchCategories')\r\n    this.loading = false\r\n    if(this.categories.length){\r\n      this.currentCategory = this.categories[0].id\r\n    }\r\n\r\n    setTimeout(() => {\r\n      this.select =  M.FormSelect.init(this.$refs.select);\r\n      M.updateTextFields()\r\n\r\n    }, 0)\r\n  },\r\n  destroyed() {\r\n      if(this.select && this.select.destroy){\r\n        this.select.destroy()\r\n      }\r\n\r\n    },\r\n    computed:{\r\n      ...mapGetters(['info']),\r\n\r\n        creaeHandler(){\r\n          if(this.type === 'income'){\r\n            return true\r\n          }\r\n          return this.info.bill >= this.amount\r\n        }\r\n    },\r\n  methods:{\r\n    async submitHandler(){\r\n        if(this.v$.description.required.$invalid == false && (this.v$.amount.required.$invalid == false && this.v$.amount.minValue.$invalid == false)){\r\n        try {\r\n            if(this.creaeHandler){\r\n               await this.$store.dispatch('createRecord', {\r\n                categoryId: this.currentCategory,\r\n                amount: this.amount,\r\n                description: this.description,\r\n                type: this.type,\r\n                date: new Date().toJSON() \r\n              })\r\n              let bill = null\r\n              if(this.type === 'income'){\r\n                bill = this.info.bill + this.amount\r\n              } else {\r\n                 bill = this.info.bill - this.amount\r\n              }\r\n              await this.$store.dispatch('updateBill', {bill})\r\n              this.$message('Запись успешно создана')\r\n              this.v$.$reset()\r\n              this.amount = ''\r\n              this.description = ''\r\n            } else {\r\n              this.$message(`Недостаточно средств (${this.amount - this.info.bill})`)\r\n            }\r\n    } catch (error){\r\n        console.log(\"ошибка в добавлении категории CATCREATE\");\r\n        console.log(error)\r\n    }\r\n        } else {\r\n     this.v$.$touch();\r\n     return\r\n    }\r\n      }\r\n  }\r\n}\r\n</script>","import { render } from \"./RecordPage.vue?vue&type=template&id=3a7c8575\"\nimport script from \"./RecordPage.vue?vue&type=script&lang=js\"\nexport * from \"./RecordPage.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"D:\\\\crm-system\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","class","for","type","_createElementBlock","_hoisted_1","_ctx","loading","_createBlock","_component_Loader","key","categories","length","onSubmit","_cache","_withModifiers","args","$options","submitHandler","_hoisted_3","ref","currentCategory","$event","_Fragment","_renderList","c","id","value","name","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","amount","_normalizeClass","invalid","$setup","v$","required","$invalid","$dirty","minValue","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","description","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_2","_createVNode","_component_router_link","to","setup","siteData","reactive","title","useHead","computed","meta","content","useVuelidate","data","select","validations","async","this","$store","dispatch","setTimeout","M","FormSelect","init","$refs","updateTextFields","destroyed","destroy","mapGetters","creaeHandler","info","bill","methods","categoryId","date","Date","toJSON","$message","$reset","error","console","log","$touch","__exports__","render"],"sourceRoot":""}