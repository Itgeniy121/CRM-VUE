"use strict";(self["webpackChunkcrm_system"]=self["webpackChunkcrm_system"]||[]).push([[844],{844:function(e,t,i){i.r(t),i.d(t,{default:function(){return x}});var n=i(3396),l=i(9242),s=i(7139);const a=(0,n._)("div",{class:"page-title"},[(0,n._)("h3",null,"Новая запись")],-1),o={key:1,class:"center"},r={class:"input-field"},u=["value"],d=(0,n._)("label",null,"Выберите категорию",-1),c=(0,n._)("span",null,"Доход",-1),p=(0,n._)("span",null,"Расход",-1),m={class:"input-field"},h=(0,n._)("label",{for:"amount"},"Сумма",-1),v={key:0,class:"helper-text invalid"},y={key:1,class:"helper-text invalid"},$={class:"input-field"},g=(0,n._)("label",{for:"description"},"Описание",-1),w={key:0,class:"helper-text invalid"},f=(0,n._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,n.Uk)(" Создать "),(0,n._)("i",{class:"material-icons right"},"send")],-1);function _(e,t,i,_,b,k){const C=(0,n.up)("Loader"),q=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",null,[a,e.loading?((0,n.wg)(),(0,n.j4)(C,{key:0})):e.categories.length?((0,n.wg)(),(0,n.iD)("form",{key:2,class:"form",onSubmit:t[5]||(t[5]=(0,l.iM)(((...e)=>k.submitHandler&&k.submitHandler(...e)),["prevent"]))},[(0,n._)("div",r,[(0,n.wy)((0,n._)("select",{ref:"select","onUpdate:modelValue":t[0]||(t[0]=t=>e.currentCategory=t)},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.categories,(e=>((0,n.wg)(),(0,n.iD)("option",{key:e.id,value:e.id},(0,s.zw)(e.name),9,u)))),128))],512),[[l.bM,e.currentCategory]]),d]),(0,n._)("p",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{class:"with-gap",name:"type",type:"radio",value:"income","onUpdate:modelValue":t[1]||(t[1]=t=>e.type=t)},null,512),[[l.G2,e.type]]),c])]),(0,n._)("p",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{class:"with-gap",name:"type",type:"radio",value:"outcome","onUpdate:modelValue":t[2]||(t[2]=t=>e.type=t)},null,512),[[l.G2,e.type]]),p])]),(0,n._)("div",m,[(0,n.wy)((0,n._)("input",{id:"amount",type:"number","onUpdate:modelValue":t[3]||(t[3]=t=>e.amount=t),class:(0,s.C_)({invalid:1==_.v$.amount.required.$invalid&&1==_.v$.amount.$dirty||1==_.v$.amount.minValue.$invalid&&1==_.v$.amount.$dirty})},null,2),[[l.nr,e.amount,void 0,{trim:!0}]]),h,1==_.v$.amount.required.$invalid&&1==_.v$.amount.$dirty?((0,n.wg)(),(0,n.iD)("span",v," Введите сумму ")):1==_.v$.amount.minValue.$invalid?((0,n.wg)(),(0,n.iD)("span",y," Сумма должна быть больше 0 ")):(0,n.kq)("",!0)]),(0,n._)("div",$,[(0,n.wy)((0,n._)("input",{id:"description",type:"text","onUpdate:modelValue":t[4]||(t[4]=t=>e.description=t),class:(0,s.C_)({invalid:1==_.v$.description.required.$invalid&&1==_.v$.description.$dirty})},null,2),[[l.nr,e.description]]),g,1==_.v$.description.required.$invalid&&1==_.v$.description.$dirty?((0,n.wg)(),(0,n.iD)("span",w," Задайте описание ")):(0,n.kq)("",!0)]),f],32)):((0,n.wg)(),(0,n.iD)("p",o,[(0,n.Uk)("Категорий пока что нет. Вы можете добавить их "),(0,n.Wm)(q,{to:"/categories"},{default:(0,n.w5)((()=>[(0,n.Uk)("тут")])),_:1})]))])}var b=i(4219),k=i(5420),C=i(65),q=i(4870),D=i(6007),V={name:"record",setup(){const e=(0,q.qj)({title:"Record",description:"aboba"});return(0,D.u)({title:(0,n.Fl)((()=>e.title)),meta:[{name:"description",content:(0,n.Fl)((()=>e.description))}]}),{v$:(0,b.Xw)()}},data:()=>({loading:!0,categories:null,select:null,currentCategory:null,type:"income",amount:null,description:null}),validations(){return{amount:{required:k.C1,minValue:(0,k.uv)(1)},description:{required:k.C1}}},async mounted(){this.categories=await this.$store.dispatch("fetchCategories"),this.loading=!1,this.categories.length&&(this.currentCategory=this.categories[0].id),setTimeout((()=>{this.select=M.FormSelect.init(this.$refs.select),M.updateTextFields()}),0)},destroyed(){this.select&&this.select.destroy&&this.select.destroy()},computed:{...(0,C.Se)(["info"]),creaeHandler(){return"income"===this.type||this.info.bill>=this.amount}},methods:{async submitHandler(){if(0==this.v$.description.required.$invalid&&0==this.v$.amount.required.$invalid&&0==this.v$.amount.minValue.$invalid)try{if(this.creaeHandler){await this.$store.dispatch("createRecord",{categoryId:this.currentCategory,amount:this.amount,description:this.description,type:this.type,date:(new Date).toJSON()});let e=null;e="income"===this.type?this.info.bill+this.amount:this.info.bill-this.amount,await this.$store.dispatch("updateBill",{bill:e}),this.$message("Запись успешно создана"),this.v$.$reset(),this.amount="",this.description=""}else this.$message(`Недостаточно средств (${this.amount-this.info.bill})`)}catch(e){console.log("ошибка в добавлении категории CATCREATE"),console.log(e)}else this.v$.$touch()}}},U=i(89);const H=(0,U.Z)(V,[["render",_]]);var x=H}}]);
//# sourceMappingURL=844.ef7c6614.js.map